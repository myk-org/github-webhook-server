# Alembic configuration for GitHub Webhook Server metrics database
# See: https://alembic.sqlalchemy.org/en/latest/tutorial.html

[alembic]
# Path to migration scripts directory
script_location = webhook_server/migrations

# Template used to generate migration files
# %%(year)d%%(month).2d%%(day).2d_%%(hour).2d%%(minute).2d_%%(rev)s_%%(slug)s
# Example: 20250123_1430_abc123def456_add_metrics_table
file_template = %%(year)d%%(month).2d%%(day).2d_%%(hour).2d%%(minute).2d_%%(rev)s_%%(slug)s

# Prepends given value to alembic.script_location
# prepend_sys_path = .

# Timezone to use when rendering the date within the migration file
# as well as the filename.
# If specified, requires the python-dateutil library.
# timezone = UTC

# Max length of characters to apply to the "slug" field
# truncate_slug_length = 40

# Set to 'true' to run the environment during the 'revision' command
# revision_environment = false

# Set to 'true' to allow .pyc and .pyo files without a .py file to be detected
# sourceless = false

# Version table name - should match across all databases
version_table = alembic_version

# Version location specification
# Determines where Alembic stores version information
# DUAL LOCATION STRATEGY:
# 1. Persistent volume: /home/podman/data/migrations/versions (existing migrations from auto-generation)
# 2. Git repository: webhook_server/migrations/versions (new migrations committed to git)
#
# This allows:
# - Existing migrations in persistent volume to be preserved
# - New migrations committed to git to be automatically applied on container restart
# - No manual intervention required - just rebuild container
version_locations = /home/podman/data/migrations/versions:%(here)s/webhook_server/migrations/versions

# Version path separator (used if version_locations is specified)
# version_path_separator = os  # Use os.pathsep. Default is ':'

# Database URL - loaded dynamically from config.yaml via env.py
# IMPORTANT: Do NOT set sqlalchemy.url here - it's loaded from config.yaml
# sqlalchemy.url =

# Logging configuration for Alembic migrations
# This section controls Alembic's own logging during migration operations
[loggers]
keys = root,sqlalchemy,alembic

[handlers]
keys = console

[formatters]
keys = generic

[logger_root]
level = INFO
handlers = console
qualname =

[logger_sqlalchemy]
level = WARN
handlers =
qualname = sqlalchemy.engine

[logger_alembic]
level = INFO
handlers =
qualname = alembic

[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

[formatter_generic]
format = %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %H:%M:%S

# Metrics-specific sections
# These are custom sections for webhook server metrics feature

[metrics]
# Feature flags for metrics migration
enable_postgres = true
enable_redis = false

# Migration behavior configuration
auto_migrate_on_startup = false
validate_schema_on_startup = true
