$schema: https://json-schema.org/draft-07/schema#
title: Webhook Server Configuration
type: object
properties:
  log-level:
    type: string
    enum:
      - INFO
      - DEBUG
  log-file:
    type: string
    description: File path for the log file
  mcp-log-file:
    type: string
    description: File path for the MCP log file
    default: mcp_server.log
  logs-server-log-file:
    type: string
    description: File path for the Logs Server log file
    default: logs_server.log
  mask-sensitive-data:
    type: boolean
    description: Mask sensitive data in logs (tokens, passwords, secrets, etc.). Default is true for security.
    default: true
  github-app-id:
    type: integer
    description: The `webhook server` GitHub app ID
  github-tokens:
    type: array
    items:
      type: string
      description: Global GitHub token for all repositories
  webhook-ip:
    type: string
    format: uri
    description: Full webhook URL including path (e.g., https://your-domain.com/webhook_server or https://smee.io/your-channel). Must include the complete path where webhooks will be received.

  ip-bind:
    type: string
    description: IP address to bind the server to
  port:
    type: integer
    description: Port to bind the server to
  max-workers:
    type: integer
    description: Maximum number of workers to run
  webhook-secret:
    type: string
    description: Secret for validating webhook
  verify-github-ips:
    type: boolean
    description: Verify hook request is from GitHub IPs
  verify-cloudflare-ips:
    type: boolean
    description: Verify hook request is from Cloudflare IPs
  disable-ssl-warnings:
    type: boolean
    description: Disable SSL warnings (useful in production to reduce log noise from SSL certificate issues)
    default: false
  docker:
    type: object
    properties:
      username:
        type: string
        description: Docker username
      password:
        type: string
        format: password
        description: Docker password
  default-status-checks:
    type: array
    items:
      type: string
  auto-verified-and-merged-users:
    type: array
    items:
      type: string
  auto-verify-cherry-picked-prs:
    type: boolean
    description: Automatically verify cherry-picked PRs (default is true for backward compatibility)
    default: true
  create-issue-for-new-pr:
    type: boolean
    description: Create a tracking issue for new pull requests (global default)
    default: true

  pr-size-thresholds:
    type: object
    description: Custom PR size thresholds with label names and colors
    additionalProperties:
      type: object
      properties:
        threshold:
          oneOf:
            - type: integer
              minimum: 1
            - type: string
              enum: ["inf"]
          description: Minimum number of changes (additions + deletions) for this size category, or 'inf' for unbounded largest category
        color:
          type: string
          description: CSS3 color name for the label (e.g., 'green', 'red', 'orange')
      required:
        - threshold
      additionalProperties: false

  branch-protection:
    type: object
    properties:
      strict:
        type: boolean
      require_code_owner_reviews:
        type: boolean
      dismiss_stale_reviews:
        type: boolean
      required_approving_review_count:
        type: integer
      required_linear_history:
        type: boolean
      required_conversation_resolution:
        type: boolean
  repositories:
    type: object
    additionalProperties:
      type: object
      properties:
        name:
          type: string
          description: Repository name (org/repo format)
        log-level:
          type: string
          enum:
            - INFO
            - DEBUG
          description: Override global log-level for repository
        log-file:
          type: string
          description: Override global log-file for repository
        mask-sensitive-data:
          type: boolean
          description: Override global mask-sensitive-data setting for this repository
          default: true
        slack-webhook-url:
          type: string
          description: Slack webhook URL
        verified-job:
          type: boolean
          default: true
          description: Enable verified job functionality
        pypi:
          type: object
          properties:
            token:
              type: string
              format: password
              description: PyPI token for publishing packages
        events:
          type: array
          items:
            type: string
          description: GitHub events to listen to
        tox:
          type: object
          patternProperties:
            "^.*$":
              oneOf:
                - type: string
                - type: array
                  items:
                    type: string
          description: Tox configuration per branch
        tox-python-version:
          type: string
          description: Python version for tox execution
        pre-commit:
          type: boolean
          default: true
          description: Enable pre-commit checks
        protected-branches:
          type: object
          additionalProperties:
            oneOf:
              - type: array
                items:
                  type: string
              - type: object
                properties:
                  include-runs:
                    type: array
                    items:
                      type: string
                  exclude-runs:
                    type: array
                    items:
                      type: string
        container:
          type: object
          properties:
            username:
              type: string
              description: Docker registry username
            password:
              type: string
              format: password
              description: Docker registry password
            repository:
              type: string
              description: Docker registry repository URL
            tag:
              type: string
              description: Image tag
            release:
              type: boolean
              description: Push image to registry on new release
            build-args:
              type: array
              items:
                type: string
              description: Build arguments for container build
            args:
              type: array
              items:
                type: string
              description: Additional arguments for build command
        auto-verified-and-merged-users:
          type: array
          items:
            type: string
          description: Users whose PRs are automatically verified and merged
        auto-verify-cherry-picked-prs:
          type: boolean
          description: Automatically verify cherry-picked PRs for this repository (default is true)
          default: true
        github-tokens:
          type: array
          items:
            type: string
          description: Override GitHub tokens for this repository
        branch-protection:
          type: object
          properties:
            strict:
              type: boolean
            require_code_owner_reviews:
              type: boolean
            dismiss_stale_reviews:
              type: boolean
            required_approving_review_count:
              type: integer
            required_linear_history:
              type: boolean
            required_conversation_resolution:
              type: boolean
        set-auto-merge-prs:
          type: array
          items:
            type: string
          description: Set auto merge for pull requests for specific branches
        can-be-merged-required-labels:
          type: array
          items:
            type: string
          description: Required labels for PR to be marked as can-be-merged
        conventional-title:
          type: string
          description: |
            Comma-separated list of allowed commit types for Conventional Commits validation.

            Enforces Conventional Commits v1.0.0 specification: <type>[optional scope]: <description>

            Standard types (recommended):
            - feat: New features (MINOR in semver)
            - fix: Bug fixes (PATCH in semver)
            - build, chore, ci, docs, style, refactor, perf, test, revert

            Custom types: The specification allows custom types (any noun).
            Examples: my-title, hotfix, release, custom

            Format requirements:
            - Type from configured list
            - Optional scope in parentheses: (scope)
            - Optional breaking change indicator: !
            - Mandatory colon + space: ": "
            - Non-empty description

            Valid examples:
            - feat: add authentication
            - fix(api): handle edge case
            - feat!: breaking change
            - my-title: custom type

            Resources: https://www.conventionalcommits.org/en/v1.0.0/
          example: "feat,fix,build,chore,ci,docs,style,refactor,perf,test,revert"
        minimum-lgtm:
          type: integer
          description: Minimum number of LGTM required before approving PR
          default: 0
        create-issue-for-new-pr:
          type: boolean
          description: Create a tracking issue for new pull requests
          default: true
        pr-size-thresholds:
          type: object
          description: Custom PR size thresholds with label names and colors (repository-specific override)
          additionalProperties:
            type: object
            properties:
              threshold:
                oneOf:
                  - type: integer
                    minimum: 1
                  - type: string
                    enum: ["inf"]
                description: Minimum number of changes (additions + deletions) for this size category, or 'inf' for unbounded largest category
              color:
                type: string
                description: CSS3 color name for the label (e.g., 'green', 'red', 'orange')
            required:
              - threshold
            additionalProperties: false
        custom-check-runs:
          type: array
          description: |
            Custom check runs that execute user-defined commands on PR events.
            Commands run in the repository worktree. If a command is not found,
            a warning is logged and the check is skipped.

            Long command example:
              - name: complex-check
                command: |
                  python -c "
                  import sys
                  print('Running complex check')
                  sys.exit(0)
                  "
          items:
            type: object
            properties:
              name:
                type: string
                description: Unique name for the check run (displayed in GitHub UI)
              command:
                type: string
                description: Command to execute in the repository directory
              env:
                type: object
                description: Environment variables to set when running the command
                additionalProperties:
                  type: string
            required:
              - name
              - command
            additionalProperties: false
