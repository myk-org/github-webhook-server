$schema: https://json-schema.org/draft-07/schema#
title: Webhook Server Configuration
type: object
properties:
  log-level:
    type: string
    enum:
      - INFO
      - DEBUG
  log-file:
    type: string
    description: File path for the log file
  mask-sensitive-data:
    type: boolean
    description: Mask sensitive data in logs (tokens, passwords, secrets, etc.). Default is true for security.
    default: true
  github-app-id:
    type: integer
    description: The `webhook server` GitHub app ID
  github-tokens:
    type: array
    items:
      type: string
      description: Global GitHub token for all repositories
  webhook-ip:
    type: string
    description: IP or FQDN address of the webhook server for adding to the repositories

  ip-bind:
    type: string
    description: IP address to bind the server to
  port:
    type: integer
    description: Port to bind the server to
  max-workers:
    type: integer
    description: Maximum number of workers to run
  webhook-secret:
    type: string
    description: Secret for validating webhook
  verify-github-ips:
    type: boolean
    description: Verify hook request is from GitHub IPs
  verify-cloudflare-ips:
    type: boolean
    description: Verify hook request is from Cloudflare IPs
  disable-ssl-warnings:
    type: boolean
    description: Disable SSL warnings (useful in production to reduce log noise from SSL certificate issues)
    default: false
  docker:
    type: object
    properties:
      username:
        type: string
        description: Docker username
      password:
        type: string
        format: password
        description: Docker password
  default-status-checks:
    type: array
    items:
      type: string
  auto-verified-and-merged-users:
    type: array
    items:
      type: string
  auto-verify-cherry-picked-prs:
    type: boolean
    description: Automatically verify cherry-picked PRs (default is true for backward compatibility)
    default: true
  create-issue-for-new-pr:
    type: boolean
    description: Create a tracking issue for new pull requests (global default)
    default: true
  max-owners-files:
    type: integer
    description: Maximum number of OWNERS files to process in a repository (default is 1000)
    default: 1000
    minimum: 1
  batch-concurrency-limit:
    type: integer
    description: >
      Maximum number of concurrent GraphQL batch operations (default is 10 to protect rate/connection limits, 0 for unlimited).
      Works together with 'graphql.query-limits': batch-concurrency-limit controls HOW MANY batch operations run in parallel,
      while query-limits controls HOW MUCH data each individual query fetches. For performance tuning, consider both settings -
      high concurrency with large query limits may exceed rate limits, while low values may slow processing. Recommended: Keep
      defaults unless you encounter rate limit errors (decrease) or slow webhook processing (increase).
    default: 10
    minimum: 0
  post-merge-relabel-delay:
    type: integer
    description: Delay in seconds before relabeling open PRs after a PR is merged (default is 30 seconds to allow GitHub to update merge states)
    default: 30
    minimum: 0

  graphql:
    type: object
    properties:
      query-limits:
        type: object
        description: "GraphQL query pagination limits (first: N). Maximum: 100 (GitHub API limit)"
        properties:
          collaborators:
            type: integer
            default: 100
            minimum: 1
            maximum: 100
            description: "Max collaborators to fetch per query"
          contributors:
            type: integer
            default: 100
            minimum: 1
            maximum: 100
            description: "Max contributors (mentionableUsers) to fetch"
          issues:
            type: integer
            default: 100
            minimum: 1
            maximum: 100
            description: "Max open issues to fetch"
          pull-requests:
            type: integer
            default: 100
            minimum: 1
            maximum: 100
            description: "Max open pull requests to fetch"
      tree-max-depth:
        type: integer
        default: 9
        minimum: 1
        maximum: 9
        description: "Max directory depth for recursive tree traversal (default: 9, max safe value for GitHub's 25 depth limit)"

  pr-size-thresholds:
    type: object
    description: Custom PR size thresholds with label names and colors
    additionalProperties:
      type: object
      properties:
        threshold:
          type: integer
          minimum: 1
          description: Minimum number of changes (additions + deletions) for this size category
        color:
          type: string
          description: CSS3 color name for the label (e.g., 'green', 'red', 'orange')
      required:
        - threshold
      additionalProperties: false

  branch-protection:
    type: object
    properties:
      strict:
        type: boolean
      require_code_owner_reviews:
        type: boolean
      dismiss_stale_reviews:
        type: boolean
      required_approving_review_count:
        type: integer
      required_linear_history:
        type: boolean
      required_conversation_resolution:
        type: boolean
  repositories:
    type: object
    additionalProperties:
      type: object
      properties:
        name:
          type: string
          description: Repository name (org/repo format)
        log-level:
          type: string
          enum:
            - INFO
            - DEBUG
          description: Override global log-level for repository
        log-file:
          type: string
          description: Override global log-file for repository
        mask-sensitive-data:
          type: boolean
          description: Override global mask-sensitive-data setting for this repository
          default: true
        slack-webhook-url:
          type: string
          description: Slack webhook URL
        verified-job:
          type: boolean
          default: true
          description: Enable verified job functionality
        pypi:
          type: object
          properties:
            token:
              type: string
              format: password
              description: PyPI token for publishing packages
        events:
          type: array
          items:
            type: string
          description: GitHub events to listen to
        tox:
          type: object
          patternProperties:
            "^.*$":
              oneOf:
                - type: string
                - type: array
                  items:
                    type: string
          description: Tox configuration per branch
        tox-python-version:
          type: string
          description: Python version for tox execution
        pre-commit:
          type: boolean
          default: true
          description: Enable pre-commit checks
        protected-branches:
          type: object
          additionalProperties:
            oneOf:
              - type: array
                items:
                  type: string
              - type: object
                properties:
                  include-runs:
                    type: array
                    items:
                      type: string
                  exclude-runs:
                    type: array
                    items:
                      type: string
        container:
          type: object
          properties:
            username:
              type: string
              description: Docker registry username
            password:
              type: string
              format: password
              description: Docker registry password
            repository:
              type: string
              description: Docker registry repository URL
            tag:
              type: string
              description: Image tag
            release:
              type: boolean
              description: Push image to registry on new release
            build-args:
              type: array
              items:
                type: string
              description: Build arguments for container build
            args:
              type: array
              items:
                type: string
              description: Additional arguments for build command
        auto-verified-and-merged-users:
          type: array
          items:
            type: string
          description: Users whose PRs are automatically verified and merged
        auto-verify-cherry-picked-prs:
          type: boolean
          description: Automatically verify cherry-picked PRs for this repository (default is true)
          default: true
        github-tokens:
          type: array
          items:
            type: string
          description: Override GitHub tokens for this repository
        branch-protection:
          type: object
          properties:
            strict:
              type: boolean
            require_code_owner_reviews:
              type: boolean
            dismiss_stale_reviews:
              type: boolean
            required_approving_review_count:
              type: integer
            required_linear_history:
              type: boolean
            required_conversation_resolution:
              type: boolean
        set-auto-merge-prs:
          type: array
          items:
            type: string
          description: Set auto merge for pull requests for specific branches
        can-be-merged-required-labels:
          type: array
          items:
            type: string
          description: Required labels for PR to be marked as can-be-merged
        conventional-title:
          type: string
          description: Comma-separated list of conventional commit prefixes
        minimum-lgtm:
          type: integer
          description: Minimum number of LGTM required before approving PR
          default: 0
        create-issue-for-new-pr:
          type: boolean
          description: Create a tracking issue for new pull requests
          default: true
        max-owners-files:
          type: integer
          description: Maximum number of OWNERS files to process in this repository (default is 1000)
          default: 1000
          minimum: 1
        batch-concurrency-limit:
          type: integer
          description: >
            Maximum number of concurrent GraphQL batch operations for this repository (default is 10, 0 for unlimited).
            Works together with 'graphql.query-limits': batch-concurrency-limit controls HOW MANY batch operations run in parallel,
            while query-limits controls HOW MUCH data each individual query fetches. For performance tuning, consider both settings -
            high concurrency with large query limits may exceed rate limits, while low values may slow processing. Recommended: Keep
            defaults unless you encounter rate limit errors (decrease) or slow webhook processing (increase).
          default: 10
          minimum: 0
        post-merge-relabel-delay:
          type: integer
          description: Delay in seconds before relabeling open PRs after a PR is merged (overrides global value for this repository)
          default: 30
          minimum: 0
        graphql:
          type: object
          properties:
            query-limits:
              type: object
              description: "GraphQL query pagination limits (first: N). Maximum: 100 (GitHub API limit)"
              properties:
                collaborators:
                  type: integer
                  default: 100
                  minimum: 1
                  maximum: 100
                  description: "Max collaborators to fetch per query"
                contributors:
                  type: integer
                  default: 100
                  minimum: 1
                  maximum: 100
                  description: "Max contributors (mentionableUsers) to fetch"
                issues:
                  type: integer
                  default: 100
                  minimum: 1
                  maximum: 100
                  description: "Max open issues to fetch"
                pull-requests:
                  type: integer
                  default: 100
                  minimum: 1
                  maximum: 100
                  description: "Max open pull requests to fetch"
            tree-max-depth:
              type: integer
              default: 9
              minimum: 1
              maximum: 9
              description: "Max directory depth for recursive tree traversal (repository-specific override, max safe value: 9)"
        pr-size-thresholds:
          type: object
          description: Custom PR size thresholds with label names and colors (repository-specific override)
          additionalProperties:
            type: object
            properties:
              threshold:
                type: integer
                minimum: 1
                description: Minimum number of changes (additions + deletions) for this size category
              color:
                type: string
                description: CSS3 color name for the label (e.g., 'green', 'red', 'orange')
            required:
              - threshold
            additionalProperties: false
