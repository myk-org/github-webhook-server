<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Webhook Server - Log Viewer</title>
    <link rel="stylesheet" href="/static/css/log_viewer.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>GitHub Webhook Server - Log Viewer</h1>
                <p>Real-time log monitoring and filtering for webhook events</p>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle between light and dark theme" aria-label="Toggle light or dark theme">
                ðŸŒ™
            </button>
        </div>

        <div class="status" id="connectionStatus">
            <span id="statusText">Connecting...</span>
        </div>

        <div class="log-stats" id="logStats" style="background: var(--container-bg); border: 1px solid var(--border-color); border-radius: 4px; padding: 10px; margin-bottom: 20px; font-size: 14px; color: var(--text-color); display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span><strong>Displayed:</strong> <span id="displayedCount">0</span> entries</span>
                <span><strong>Total Available:</strong> <span id="totalCount">0</span> entries</span>
                <span><strong>Processed:</strong> <span id="processedCount">0</span> entries</span>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="connectWebSocket()">Start Real-time</button>
            <button class="btn" onclick="disconnectWebSocket()">Stop Real-time</button>
            <button class="btn" onclick="loadHistoricalLogs()">Refresh</button>
            <button class="btn" onclick="clearFilters()">Clear Filters</button>
            <button class="btn" onclick="clearLogs()">Clear Logs</button>
            <button class="btn" onclick="exportLogs('json')">Export JSON</button>
        </div>

        <div class="filters">
            <div class="filter-group">
                <label for="hookIdFilter">Hook ID:</label>
                <input type="text" id="hookIdFilter" placeholder="delivery-id" title="x-github-delivery value">
            </div>
            <div class="filter-group">
                <label for="prNumberFilter">PR #:</label>
                <input type="number" id="prNumberFilter" placeholder="123">
            </div>
            <div class="filter-group">
                <label for="repositoryFilter">Repository:</label>
                <input type="text" id="repositoryFilter" placeholder="org/repo">
            </div>
            <div class="filter-group">
                <label for="userFilter">User:</label>
                <input type="text" id="userFilter" placeholder="username">
            </div>
            <div class="filter-group">
                <label for="levelFilter">Level:</label>
                <select id="levelFilter">
                    <option value="">All</option>
                    <option value="DEBUG">DEBUG</option>
                    <option value="INFO">INFO</option>
                    <option value="WARNING">WARNING</option>
                    <option value="ERROR">ERROR</option>
                    <option value="STEP">STEP</option>
                    <option value="SUCCESS">SUCCESS</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="searchFilter">Search:</label>
                <input type="text" id="searchFilter" placeholder="text in messages...">
            </div>
            <div class="filter-group">
                <label for="limitFilter">Results Limit:</label>
                <select id="limitFilter">
                    <option value="100">100</option>
                    <option value="500">500</option>
                    <option value="1000" selected>1000</option>
                    <option value="5000">5000</option>
                    <option value="10000">10000</option>
                </select>
            </div>
        </div>

        <!-- Hook ID Flow Timeline -->
        <div class="timeline-section" id="timelineSection">
            <div class="timeline-header" onclick="toggleTimeline()">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <h3>Hook ID Flow Timeline</h3>
                    <button class="timeline-toggle" id="timelineToggle" onclick="event.stopPropagation(); toggleTimeline();">
                        â–¶ Expand
                    </button>
                </div>
                <div class="timeline-info" id="timelineInfo">
                    <!-- Timeline metadata will be populated here -->
                </div>
            </div>
            <div class="timeline-content collapsed" id="timelineContent">
                <div class="timeline-container">
                    <svg class="timeline-svg" id="timelineSvg">
                        <!-- Timeline visualization will be generated here -->
                    </svg>
                    <div class="timeline-tooltip" id="timelineTooltip"></div>
                </div>
            </div>
        </div>

        <div class="log-entries" id="logEntries">
            <!-- Log entries will be populated here -->
        </div>
    </div>

    <script src="/static/js/log_viewer.js"></script>
</body>
</html>
